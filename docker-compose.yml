version: '3.0'

services:
  service-discovery:
    build:
      context: ./service-discovery
    container_name: service-discovery
    ports:
      - "8999:8999"
    environment:
      - SERVER_PORT=8999
    networks:
      - app-network

  auth-service:
    build:
      context: ./auth-service
    container_name: auth-service
    ports:
      - "8082:8082"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://service-discovery:8999/eureka/
      - SPRING_RABBITMQ_HOST=rabbitmq
    depends_on:
      - service-discovery
      - rabbitmq
    networks:
      - app-network

  laundry-service:
    build:
      context: ./laundry-service
    container_name: laundry-service
    ports:
      - "8089:8089"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://service-discovery:8999/eureka/
      - SPRING_RABBITMQ_HOST=rabbitmq 
      - SPRING_RABBITMQ_USERNAME=admin
      - SPRING_RABBITMQ_PASSWORD=admin
    depends_on:
      - service-discovery
      - rabbitmq
    networks:
      - app-network

  gateway-service:
    build:
      context: ./gateway-service
    container_name: gateway-service
    ports:
      - "8081:8081"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://service-discovery:8999/eureka/
      - JWT_SECRET=UmaSenhaLongaParaGerarHash
    depends_on:
      - service-discovery
      - auth-service
      - laundry-service
    networks:
      - app-network

  rabbitmq:
    image: "rabbitmq:4.1.4-management"
    container_name: rabbitmq
    environment:
      - RABBITMQ_DEFAULT_USER=admin
      - RABBITMQ_DEFAULT_PASS=admin
    ports:
      - "5672:5672"
      - "15672:15672"
    networks:
      - app-network

networks:
  app-network:
    driver: bridge